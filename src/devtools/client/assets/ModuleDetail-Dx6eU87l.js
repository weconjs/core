import{b as S,r as m,u as w,d as C,a as g,j as e,m as j}from"./index-DoHRi03N.js";import{C as b}from"./CopyButton-DIdtJD4_.js";import{L as N}from"./loader-circle-DoOjJ8vr.js";import{A as E,S as z}from"./save-CV1xmSXO.js";import"./copy-BvbhBv2y.js";function J(){var y;const{name:t}=S(),[s,l]=m.useState(null),[d,o]=m.useState(!0),h=w(),{addToast:u}=C(),[x,f]=m.useState([]);return m.useEffect(()=>{t&&Promise.all([g.get(`/modules/${t}`),g.get("/routes")]).then(([c,a])=>{l(c.data);const n=(a.data??[]).filter(i=>i.module===t);f(n)}).catch(console.error).finally(()=>o(!1))},[t]),d?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(N,{className:"size-8 animate-spin text-primary"})}):s?e.jsxs(j.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex size-full flex-col gap-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h("/modules"),className:"flex size-8 items-center justify-center rounded-secondary border border-primary transition-colors hover:bg-primary",children:e.jsx(E,{className:"size-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary",children:s.name}),e.jsxs("p",{className:"text-sm text-secondary",children:["namespace: ",s.namespace," Â· ",x.length," routes"]})]})]}),s.description&&e.jsx("p",{className:"text-sm text-secondary",children:s.description}),s.hasConfig&&((y=s.config)==null?void 0:y.current)&&e.jsx(M,{moduleName:s.name,config:s.config.current,addToast:u}),x.length>0&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary",children:"Routes"}),e.jsx("div",{className:"overflow-auto rounded-secondary border border-primary",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-primary bg-primary text-left text-xs text-secondary",children:[e.jsx("th",{className:"px-4 py-2",children:"Method"}),e.jsx("th",{className:"px-4 py-2",children:"Path"}),e.jsx("th",{className:"px-4 py-2",children:"RAI"})]})}),e.jsx("tbody",{children:x.map((c,a)=>e.jsxs("tr",{className:"border-b border-primary last:border-0",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx(P,{method:c.method})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"group flex items-center gap-1.5",children:[e.jsx("span",{className:"font-mono text-xs text-primary",children:c.path}),e.jsx("span",{className:"opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(b,{value:c.path})})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"group flex items-center gap-1.5",children:[e.jsx("span",{className:"font-mono text-xs text-secondary",children:c.rai}),e.jsx("span",{className:"opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(b,{value:c.rai})})]})})]},a))})]})})]})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx("p",{className:"text-secondary",children:"Module not found"})})}function M({moduleName:t,config:s,addToast:l}){const[d,o]=m.useState(JSON.parse(JSON.stringify(s))),[h,u]=m.useState(!1),[x,f]=m.useState(!1),y=(a,r,n)=>{let i=r;if(n==="boolean")i=r==="true";else if(n==="number")i=r===""?0:Number(r);else if(n==="object")try{i=JSON.parse(r)}catch{i=r}o(p=>({...p,[a]:i})),u(!0)},c=async()=>{var a,r,n,i;f(!0);try{await g.put(`/config/${t}`,d),u(!1),l({type:"success",message:`${t} config saved`})}catch(p){const v=((i=(n=(r=(a=p==null?void 0:p.response)==null?void 0:a.data)==null?void 0:r.errors)==null?void 0:n[0])==null?void 0:i.message)||"Validation failed";l({type:"error",message:v})}finally{f(!1)}};return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary",children:"Config"}),h&&e.jsxs(j.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileTap:{scale:.95},onClick:c,disabled:x,className:"flex items-center gap-2 rounded-secondary bg-btn-primary px-4 py-2 text-sm font-medium text-btn-primary transition-opacity hover:opacity-90 disabled:opacity-50",children:[x?e.jsx(N,{className:"size-4 animate-spin"}):e.jsx(z,{className:"size-4"}),"Save"]})]}),e.jsx("div",{className:"rounded-secondary border border-primary bg-secondary p-4",children:e.jsx("div",{className:"flex flex-col gap-3",children:Object.entries(d).map(([a,r])=>e.jsx(O,{label:a,value:r,onChange:(n,i)=>y(a,n,i)},a))})})]})}function O({label:t,value:s,onChange:l}){const d=typeof s;return d==="boolean"?e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:t}),e.jsx("button",{onClick:()=>l(String(!s),"boolean"),className:`relative h-6 w-11 rounded-full transition-colors ${s?"bg-green-500":"bg-gray-300"}`,children:e.jsx("span",{className:`absolute left-0.5 top-0.5 size-5 rounded-full bg-white shadow transition-transform ${s?"translate-x-5":"translate-x-0"}`})})]}):d==="number"?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-4",children:[e.jsx("label",{className:"min-w-[160px] text-sm font-medium text-primary",children:t}),e.jsx("input",{type:"number",value:String(s),onChange:o=>l(o.target.value,"number"),className:"w-full rounded-tertiary border border-primary bg-primary px-3 py-1.5 text-sm text-primary outline-none focus:border-blue-500"})]}):d==="object"?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-medium text-primary",children:t}),e.jsx("textarea",{value:JSON.stringify(s,null,2),onChange:o=>l(o.target.value,"object"),rows:Math.min(Object.keys(s||{}).length+2,10),className:"w-full rounded-tertiary border border-primary bg-primary px-3 py-1.5 font-mono text-xs text-primary outline-none focus:border-blue-500"})]}):e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-4",children:[e.jsx("label",{className:"min-w-[160px] text-sm font-medium text-primary",children:t}),e.jsx("input",{type:"text",value:String(s??""),onChange:o=>l(o.target.value,"string"),className:"w-full rounded-tertiary border border-primary bg-primary px-3 py-1.5 text-sm text-primary outline-none focus:border-blue-500"})]})}function P({method:t}){const s={GET:"bg-green-100 text-green-700",POST:"bg-blue-100 text-blue-700",PUT:"bg-yellow-100 text-yellow-700",PATCH:"bg-orange-100 text-orange-700",DELETE:"bg-red-100 text-red-700"};return e.jsx("span",{className:`inline-block rounded px-2 py-0.5 text-xs font-semibold ${s[t.toUpperCase()]??"bg-gray-100 text-gray-700"}`,children:t.toUpperCase()})}export{J as default};
