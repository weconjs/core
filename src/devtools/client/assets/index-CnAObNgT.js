import{c as w,r as j,d as O,j as e,m as P,a as C}from"./index-DoHRi03N.js";import{C as R}from"./CopyButton-DIdtJD4_.js";import{L as E}from"./loader-circle-DoOjJ8vr.js";import{C as V}from"./chevron-right-E9DzkOHY.js";import"./copy-BvbhBv2y.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=w("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=w("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=w("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),U=["app.name","mode"];function v(s,i,c){const m=JSON.parse(JSON.stringify(s)),n=i.split(".");let o=m;for(let t=0;t<n.length-1;t++)o[n[t]]===void 0&&(o[n[t]]={}),o=o[n[t]];return o[n[n.length-1]]=c,m}function _(){const[s,i]=j.useState(null),[c,m]=j.useState(!0),{addToast:n}=O();j.useEffect(()=>{(async()=>{try{const[r,d]=await Promise.all([C.get("/config"),C.get("/modules")]),p=r.data??{},y=d.data??[],u={},N=y.filter(f=>f.hasConfig).map(async f=>{try{const g=await C.get(`/config/${f.name}`);g.data&&Object.keys(g.data).length>0&&(u[f.name]=g.data)}catch{}});await Promise.all(N),Object.keys(u).length>0&&(p.moduleConfigs=u),i(p)}catch(r){console.error(r)}finally{m(!1)}})()},[]);const o=(a,r)=>{s&&i(v(s,a,r))},t=async(a,r)=>{var p,y,u,N,f,g,$,l,x;const d=a.match(/^moduleConfigs\.([^.]+)\.(.+)$/);if(d){const[,h,b]=d,z=((p=s==null?void 0:s.moduleConfigs)==null?void 0:p[h])??{},A=v(z,b,r);try{await C.put(`/config/${h}`,A),o(a,r),n({type:"success",message:`Updated ${h}.${b}`})}catch(k){const M=((f=(N=(u=(y=k==null?void 0:k.response)==null?void 0:y.data)==null?void 0:u.errors)==null?void 0:N[0])==null?void 0:f.message)||`Failed to update ${h}.${b}`;n({type:"error",message:M})}return}try{await C.put("/config",{path:a,value:r}),o(a,r),n({type:"success",message:`Updated ${a}`})}catch(h){const b=((x=(l=($=(g=h==null?void 0:h.response)==null?void 0:g.data)==null?void 0:$.errors)==null?void 0:l[0])==null?void 0:x.message)||`Failed to update ${a}`;n({type:"error",message:b})}};return c?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(E,{className:"size-8 animate-spin text-primary"})}):e.jsxs(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex size-full flex-col gap-6 overflow-y-auto p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary",children:"Configuration"}),e.jsx("p",{className:"mt-1 text-sm text-secondary",children:"Click on any value to edit it. Changes are saved instantly."})]}),s&&e.jsx("div",{className:"rounded-primary border border-primary bg-secondary p-5",children:e.jsx(S,{data:s,path:"",onSave:t,addToast:n})})]})}function S({data:s,depth:i=0,path:c,onSave:m,addToast:n}){if(s==null)return e.jsx("span",{className:"text-gray-400 italic",children:"null"});if(typeof s!="object")return e.jsx(L,{value:s,path:c,onSave:m,addToast:n});if(Array.isArray(s))return s.length===0?e.jsx("span",{className:"text-gray-400",children:"[]"}):e.jsx("div",{className:"flex flex-col gap-0.5",style:{marginLeft:i>0?20:0},children:s.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsxs("span",{className:"mt-0.5 font-mono text-[10px] text-gray-400 select-none",children:["[",a,"]"]}),e.jsx(S,{data:t,depth:i+1,path:c?`${c}.${a}`:`${a}`,onSave:m,addToast:n})]},a))});const o=Object.entries(s);return o.length===0?e.jsx("span",{className:"text-gray-400",children:"{}"}):e.jsx("div",{className:"flex flex-col gap-0.5",style:{marginLeft:i>0?20:0},children:o.map(([t,a])=>e.jsx(B,{propKey:t,value:a,depth:i,path:c?`${c}.${t}`:t,onSave:m,addToast:n},t))})}function B({propKey:s,value:i,depth:c,path:m,onSave:n,addToast:o}){const[t,a]=j.useState(c<2),r=typeof i=="object"&&i!==null,d=m.match(/^moduleConfigs\.[^.]+$/)!==null;return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:`flex items-center gap-1.5 py-0.5 font-mono text-xs ${r?"cursor-pointer hover:bg-primary/30 -mx-1 px-1 rounded-tertiary":""} ${d?"mt-1":""}`,onClick:()=>r&&a(!t),children:[r?t?e.jsx(T,{className:"size-3 shrink-0 text-secondary"}):e.jsx(V,{className:"size-3 shrink-0 text-secondary"}):e.jsx("span",{className:"inline-block w-3 shrink-0"}),e.jsx("span",{className:`font-semibold ${d?"text-blue-600":"text-primary"}`,children:s}),e.jsx("span",{className:"text-gray-400",children:":"}),!r&&e.jsx("span",{className:"ml-1 flex items-center gap-1",children:e.jsx(L,{value:i,path:m,onSave:n,addToast:o})}),r&&!t&&e.jsx("span",{className:"text-gray-400",children:Array.isArray(i)?`[${i.length}]`:`{${Object.keys(i).length}}`})]}),r&&t&&e.jsx(S,{data:i,depth:c+1,path:m,onSave:n,addToast:o})]})}function L({value:s,path:i,onSave:c,addToast:m}){const[n,o]=j.useState(!1),[t,a]=j.useState(""),[r,d]=j.useState(!1),p=j.useRef(null),y=U.includes(i),u=()=>{y||r||(a(String(s??"")),o(!0),setTimeout(()=>{var l;return(l=p.current)==null?void 0:l.select()},0))},N=()=>{o(!1)},f=async()=>{if(r)return;const l=t.trim();let x=l;if(l==="true"?x=!0:l==="false"?x=!1:l==="null"?x=null:l!==""&&!isNaN(Number(l))&&(x=Number(l)),x===s){o(!1);return}d(!0);try{await c(i,x)}finally{d(!1),o(!1)}},g=l=>{l.key==="Enter"&&f(),l.key==="Escape"&&N()};if(r)return e.jsx(E,{className:"size-3 animate-spin text-secondary"});if(n)return e.jsx("input",{ref:p,type:"text",value:t,onChange:l=>a(l.target.value),onKeyDown:g,onBlur:f,autoFocus:!0,className:"max-w-[300px] rounded-tertiary border border-blue-400 bg-primary px-1.5 py-0.5 font-mono text-xs text-primary outline-none"});const $=()=>s==null?e.jsx("span",{className:"italic text-gray-400",children:"null"}):typeof s=="string"?e.jsxs("span",{className:"text-green-600",children:['"',s,'"']}):typeof s=="boolean"?e.jsx("span",{className:"text-blue-600",children:s?"true":"false"}):e.jsx("span",{className:"text-orange-600",children:String(s)});return e.jsxs("span",{className:"group/leaf inline-flex items-center gap-1",children:[e.jsx("span",{onClick:u,className:y?"":"cursor-pointer rounded-tertiary px-0.5 transition-colors hover:bg-primary/50",children:$()}),y?e.jsx(D,{className:"size-3 text-gray-400"}):e.jsxs("span",{className:"flex items-center gap-0.5 opacity-0 transition-opacity group-hover/leaf:opacity-100",children:[e.jsx("button",{onClick:u,className:"rounded-tertiary p-0.5 transition-colors hover:bg-primary",children:e.jsx(J,{className:"size-3 text-secondary"})}),e.jsx(R,{value:String(s??"")})]})]})}export{_ as default};
